<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeetingSense | AI-Powered Professional Meeting System</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Skip Navigation for Accessibility -->
    <a href="#main-content" class="skip-to-main">Skip to main content</a>
    
    <!-- Screen Reader Status Announcer -->
    <div class="sr-only" aria-live="polite" aria-atomic="true" id="status-announcer"></div>

    <div class="app-container" id="app-container">
        <!-- Header -->
        <header class="app-header" role="banner">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-video" aria-hidden="true"></i>
                    <h1>MeetingSense</h1>
                    <span class="beta-tag">AI</span>
                </div>
                <div class="header-info">
                    <div class="session-time">
                        <i class="fas fa-clock" aria-hidden="true"></i>
                        <span id="current-time">--:--:--</span>
                    </div>
                    <div class="meeting-status" id="meeting-status">
                        <i class="fas fa-users" aria-hidden="true"></i>
                        <span id="meeting-status-text">No Active Meeting</span>
                    </div>
                    <button id="reset-app" class="btn btn-secondary btn-small" aria-label="Start new meeting">
                        <i class="fas fa-redo"></i>
                        Start New Meeting
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="main-content" role="main">
            <!-- Left Panel - Main Content -->
            <div class="left-panel">
                <!-- Meeting Setup Card -->
                <section class="card meeting-setup-card" aria-labelledby="meeting-setup-title">
                    <div class="card-header">
                        <div class="card-header-content">
                            <i class="fas fa-cogs" aria-hidden="true"></i>
                            <h2 id="meeting-setup-title">Meeting Setup</h2>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label for="meeting-title">
                                <span style="font-size: 1.2em;">üìã</span>
                                Meeting Title
                            </label>
                            <input type="text" id="meeting-title" placeholder="Enter meeting title" required>
                            <div class="input-error">Please enter a meeting title</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="meeting-agenda">
                                <span style="font-size: 1.2em;">üìù</span>
                                Meeting Agenda
                            </label>
                            <textarea id="meeting-agenda" placeholder="Describe the purpose and agenda for better AI analysis" rows="3" required></textarea>
                            <div class="input-error">Please enter meeting agenda</div>
                        </div>

                        <div class="input-group">
                            <label for="meeting-emails">
                                <span style="font-size: 1.2em;">üìß</span>
                                Send Summary To (Optional)
                            </label>
                            <input type="text" id="meeting-emails" placeholder="email1@example.com, email2@example.com">
                            <div class="input-hint">Separate multiple emails with commas</div>
                        </div>
                        
                        <div class="control-section">
                            <button id="create-meeting" class="btn btn-success" aria-label="Create new meeting">
                                <i class="fas fa-play-circle"></i>
                                Create Meeting
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Active Meeting Control Card -->
                <section class="card meeting-control-card" id="active-meeting-controls" style="display: none;" aria-labelledby="meeting-controls-title">
                    <div class="card-header">
                        <div class="card-header-content">
                            <span style="font-size: 1.2em;">‚öôÔ∏è</span>
                            <h2 id="meeting-controls-title">Meeting Controls</h2>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="meeting-info">
                            <div class="meeting-info-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span id="meeting-date-display">--</span>
                            </div>
                            <div class="info-item">
                                <span style="font-size: 1.2em;">‚è±Ô∏è</span>
                                <span id="meeting-duration">00:00:00</span>
                            </div>
                        </div>

                        <!-- Camera Configuration -->
                        <div class="control-section">
                            <h3>Attendance Camera</h3>
                            <div class="input-group">
                                <select id="camera-source" class="camera-select" aria-label="Select camera for face recognition">
                                    <option value="0">Default Camera</option>
                                    <option value="1">Camera 1</option>
                                    <option value="2">Camera 2</option>
                                    <option value="url">External URL</option>
                                </select>
                                <div class="input-hint">Select camera for face recognition</div>
                            </div>

                            <div id="camera-url-input" class="input-group" style="display: none;">
                                <input type="text" id="camera-url" placeholder="http://camera.stream.url" aria-label="Camera stream URL">
                            </div>
            
                            <!-- Video Camera Selection -->
                            <div class="input-group">
                                <label for="video-camera-index">
                                    <i class="fas fa-camera"></i>
                                    Video Camera
                                </label>
                                <select id="video-camera-index" class="camera-select" aria-label="Select camera for video recording">
                                    <option value="0">Camera 0 (Default)</option>
                                    <option value="1">Camera 1</option>
                                    <option value="2">Camera 2</option>
                                </select>
                                <div class="input-hint">Select camera for video recording</div>
                            </div>
                        </div>

                        <!-- Main Control Buttons -->
                        <div class="control-section main-controls">
                            <div class="control-item">
                                <h3>Attendance System</h3>
                                <div class="button-group">
                                    <button id="start-attendance" class="btn btn-primary" aria-label="Start attendance tracking">
                                        <span style="font-size: 1.2em;">üë§‚úÖ</span>
                                        Start
                                    </button>
                                    <button id="stop-attendance" class="btn btn-error" style="display: none;" aria-label="Stop attendance tracking">
                                        <span style="font-size: 1.2em;">üë§</span>
                                        Stop
                                    </button>
                                </div>
                                <div class="input-hint">Face recognition attendance tracking</div>
                            </div>

                            <div class="control-item">
                                <h3>Recording</h3>
                                <div class="button-group">
                                    <button id="start-recording" class="btn btn-primary" aria-label="Start recording">
                                        <span style="font-size: 1.2em;">‚è∫Ô∏è</span>
                                        Start Recording
                                    </button>
                                    <button id="stop-recording" class="btn btn-error" style="display: none;" aria-label="Stop recording">
                                        <span style="font-size: 1.2em;">‚èπÔ∏è</span>
                                        Stop Recording
                                    </button>
                                </div>
                                <div class="recording-timer" id="video-recording-timer" style="display: none; margin-top: 8px; font-size: 0.9em; color: #666;">
                                    <span style="font-size: 1.2em;">‚è±Ô∏è</span>
                                    <span id="video-recording-timer-text">00:00:00</span>
                                </div>
                                <div class="input-hint">Starts both audio and video recording</div>
                            </div>
                        </div>

                        <div class="control-section">
                            <button id="end-meeting" class="btn btn-error btn-block" aria-label="End meeting and generate summary">
                                <span style="font-size: 1.2em;">‚èπÔ∏èüìä</span>
                                End Meeting & Generate Summary
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Live Camera Feed Card -->
                <section class="card video-feed-card" aria-labelledby="camera-feed-title">
                    <div class="card-header">
                        <div class="card-header-content">
                            <span style="font-size: 1.2em;">üì∑</span>
                            <h2 id="camera-feed-title">Live Camera</h2>
                        </div>
                        <div class="status-indicator">
                            <span class="status-dot" id="camera-status" aria-hidden="true"></span>
                            <span id="camera-status-text">Camera Offline</span>
                            <!-- Video Recording Status Indicator -->
                            <span id="video-recording-status" class="video-status idle" aria-label="Video recording status">‚óè</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="video-container">
                            <!-- OBS Status Display -->
                            <div id="obs-status" style="display: none; position: absolute; top: 10px; right: 10px; background: rgba(0, 0, 0, 0.7); color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; z-index: 100;">
                                üé• OBS Virtual Camera
                            </div>
                            
                            <canvas id="video-canvas" role="img" aria-label="Live camera feed for face recognition attendance tracking">
                                <span class="sr-only">Live camera feed showing face recognition for attendance tracking. 
                                When active, it will display detected faces with recognition status.</span>
                            </canvas>
                            <!-- Image element that points to the live feed endpoint. Displayed by default; JS can hide/show as needed. -->
                            <img id="videoFeed" src="/video_feed" alt="Live Video Feed" style="width: 100%; height: auto; border-radius: 8px; display: block;" />
                            <div class="video-overlay" id="video-overlay">
                                <span style="font-size: 2.5em;">üì∑</span>
                                <p>Live Camera Feed</p>
                                <small>Start camera to begin face recognition</small>
                            </div>
                        </div>
                        <div class="video-stats">
                            <div class="stat-item">
                                <span style="font-size: 1.2em;">üë•</span>
                                <span id="face-count">0 Detected</span>
                            </div>
                            <div class="stat-item">
                                <span style="font-size: 1.2em;">‚úÖ</span>
                                <span id="present-count">0 Present</span>
                            </div>
                            <div class="stat-item">
                                <span style="font-size: 1.2em;">üìä</span>
                                <span id="attendance-rate-live">0%</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Panel - Side Panel -->
            <div class="right-panel">
                <!-- Attendance Summary Card -->
                <section class="card summary-card" aria-labelledby="attendance-summary-title">
                    <div class="card-header">
                        <div class="card-header-content">
                            <span style="font-size: 1.2em;">üìà</span>
                            <h2 id="attendance-summary-title">Attendance Summary</h2>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="summary-grid">
                            <div class="summary-item total">
                                <div class="summary-content">
                                    <span class="summary-label">Total</span>
                                    <span class="summary-value" id="total-count">0</span>
                                </div>
                            </div>
                            <div class="summary-item present">
                                <div class="summary-content">
                                    <span class="summary-label">Present</span>
                                    <span class="summary-value" id="present-count-summary">0</span>
                                </div>
                            </div>
                            <div class="summary-item rate">
                                <div class="summary-content">
                                    <span class="summary-label">Attendance</span>
                                    <span class="summary-value" id="attendance-rate">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Live Attendance List Card -->
                <section class="card attendance-card" aria-labelledby="attendance-list-title">
                    <div class="card-header">
                        <div class="card-header-content">
                            <span style="font-size: 1.2em;">üìã</span>
                            <h2 id="attendance-list-title">Attendance List</h2>
                        </div>
                        <div class="header-actions">
                            <button id="refresh-attendance" class="btn-icon" title="Refresh attendance list" aria-label="Refresh attendance">
                                <span style="font-size: 1.2em;">üîÑ</span>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="attendance-list" id="attendance-list" aria-live="polite">
                            <div class="empty-state">
                                <span style="font-size: 2em;">üë§‚è∞</span>
                                <p>No attendance data</p>
                                <small>Start attendance tracking</small>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Register New Attendee Card -->
                <section class="card add-attendee-card" aria-labelledby="register-attendee-title">
                    <div class="card-header">
                        <div class="card-header-content">
                            <span style="font-size: 1.2em;">üë§‚ûï</span>
                            <h2 id="register-attendee-title">Register Attendee</h2>
                        </div>
                    </div>
                    <div class="card-body">
                        <form id="add-attendee-form" class="attendee-form">
                            <div class="form-group">
                                <label for="attendee-name">
                                    <span style="font-size: 1.2em;">üë§</span>
                                    Full Name
                                </label>
                                <input type="text" id="attendee-name" name="name" required placeholder="Enter full name" aria-required="true">
                                <div class="input-error">Name is required</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="attendee-photo">
                                    <span style="font-size: 1.2em;">üì∑</span>
                                    Face Photo
                                </label>
                                <div class="file-upload-area" id="upload-area" role="button" tabindex="0" aria-label="Upload face photo">
                                    <span style="font-size: 1.5em;">‚òÅÔ∏è‚¨ÜÔ∏è</span>
                                    <p>Upload face photo</p>
                                    <small>JPG, PNG - Max 5MB</small>
                                    <input type="file" id="attendee-photo" name="photo" accept="image/*" aria-required="false">
                                </div>
                                <div class="file-preview" id="file-preview" style="display: none;">
                                    <img id="preview-image" src="" alt="Face photo preview">
                                    <button type="button" id="remove-preview" class="remove-btn" aria-label="Remove photo">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="attendee-audio">
                                    <span style="font-size: 1.2em;">üé§</span>
                                    Voice Sample (Optional)
                                </label>
                                <div class="audio-options">
                                    <div class="audio-option" id="audio-upload-option" role="button" tabindex="0" aria-label="Upload audio file">
                                        <span style="font-size: 1.2em;">‚òÅÔ∏è‚¨ÜÔ∏è</span>
                                        <span>Upload Audio</span>
                                        <small>MP3, WAV, M4A</small>
                                        <input type="file" id="attendee-audio" name="audio" accept="audio/*" style="display: none;">
                                    </div>
                                    <div class="audio-option" id="audio-record-option" role="button" tabindex="0" aria-label="Record audio">
                                        <span style="font-size: 1.2em;">üé§</span>
                                        <span>Record Voice</span>
                                        <small>Record now</small>
                                    </div>
                                </div>
                                
                                <!-- Audio Recording Controls -->
                                <div class="audio-recording-controls" id="audio-recording-controls" style="display: none;">
                                    <div class="recording-header">
                                        <div class="recording-indicator">
                                            <span class="recording-dot"></span>
                                            <span>Recording...</span>
                                        </div>
                                        <div class="recording-timer" id="audio-recording-timer">00:00</div>
                                    </div>
                                    
                                    <!-- Audio Visualizer -->
                                    <div class="recording-visualizer" id="audio-visualizer" style="display: none;">
                                        <div class="visualizer-bar"></div>
                                        <div class="visualizer-bar"></div>
                                        <div class="visualizer-bar"></div>
                                        <div class="visualizer-bar"></div>
                                        <div class="visualizer-bar"></div>
                                    </div>
                                    
                                    <div class="recording-actions">
                                        <button type="button" id="stop-audio-recording" class="btn btn-error">
                                            <i class="fas fa-stop"></i> Stop Recording
                                        </button>
                                        <button type="button" id="cancel-audio-recording" class="btn btn-secondary">
                                            <i class="fas fa-times"></i> Cancel
                                        </button>
                                    </div>
                                </div>

                                <!-- Audio Preview -->
                                <div class="audio-preview" id="audio-preview" style="display: none;">
                                    <div class="audio-player">
                                        <audio id="audio-player" controls aria-label="Audio preview"></audio>
                                    </div>
                                    <button type="button" id="remove-audio" class="btn btn-secondary btn-small" aria-label="Remove audio">
                                        <i class="fas fa-times"></i> Remove Audio
                                    </button>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-success submit-btn">
                                <span style="font-size: 1.2em;">üë§‚ûï</span>
                                Register Attendee
                            </button>
                        </form>
                    </div>
                </section>
            </div>
        </main>

        <!-- Confirmation Modal -->
        <div id="confirmation-modal" class="modal" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="modal-title">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title">Confirm Action</h3>
                    <button class="modal-close" id="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="modal-message">Are you sure you want to proceed?</p>
                </div>
                <div class="modal-footer">
                    <button id="modal-cancel" class="btn btn-secondary">Cancel</button>
                    <button id="modal-confirm" class="btn btn-error">Confirm</button>
                </div>
            </div>
        </div>

        <!-- Summary Popup -->
        <div id="summary-popup" class="summary-popup" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="summary-popup-title">
            <div class="summary-popup-content">
                <div class="summary-popup-header">
                    <h3 id="summary-popup-title">
                        <span style="font-size: 1.2em;">üìã</span>
                        Meeting Summary
                    </h3>
                    <button class="summary-popup-close" id="summary-close-popup" aria-label="Close summary dialog">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="summary-popup-body">
                    <!-- Meeting Info -->
                    <div class="summary-meeting-info">
                        <div class="meeting-title-display" id="summary-meeting-title">--</div>
                        <div class="meeting-details">
                            <div class="detail-item">
                                <i class="fas fa-calendar"></i>
                                <span id="summary-meeting-date">--</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-clock"></i>
                                <span id="summary-meeting-duration">--</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-hashtag"></i>
                                <span id="summary-meeting-id">--</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- File Status Section -->
                    <div class="file-status-section">
                        <h4><i class="fas fa-file-alt"></i> Generated Files Status</h4>
                        <div class="status-grid">
                            <div class="status-item">
                                <span class="status-label">
                                    <i class="fas fa-file-pdf"></i>
                                    Summary PDF
                                </span>
                                <span class="summary-status-value checking" id="summary-pdf-status">Checking...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">
                                    <i class="fas fa-file-excel"></i>
                                    Attendance Report
                                </span>
                                <span class="summary-status-value checking" id="summary-excel-status">Checking...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">
                                    <i class="fas fa-file-text"></i>
                                    Full Transcript
                                </span>
                                <span class="summary-status-value checking" id="summary-transcript-status">Checking...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">
                                    <i class="fas fa-file-audio"></i>
                                    Audio Recording
                                </span>
                                <span class="summary-status-value checking" id="summary-audio-status">Checking...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">
                                    <i class="fas fa-file-video"></i>
                                    Video Recording
                                </span>
                                <span class="summary-status-value checking" id="summary-video-status">Checking...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Download Actions -->
                    <div class="download-actions">
                        <div class="action-group">
                            <button id="summary-download-pdf" class="btn btn-primary" disabled>
                                <i class="fas fa-download"></i>
                                Download Summary PDF
                            </button>
                            <button id="summary-download-excel" class="btn btn-success" disabled>
                                <i class="fas fa-download"></i>
                                Download Excel Report
                            </button>
                        </div>
                        
                        <div class="action-group">
                            <button id="summary-download-transcript" class="btn btn-secondary">
                                <i class="fas fa-download"></i>
                                Download Transcript
                            </button>
                            <button id="summary-download-audio" class="btn btn-secondary">
                                <i class="fas fa-download"></i>
                                Download Audio
                            </button>
                            <button id="summary-download-video" class="btn btn-secondary">
                                <i class="fas fa-download"></i>
                                Download Video
                            </button>
                        </div>
                        
                        <div class="action-group">
                            <button id="summary-email-pdf" class="btn btn-info">
                                <i class="fas fa-envelope"></i>
                                Email Summary to Participants
                            </button>
                        </div>
                    </div>
                    
                    <div class="summary-note">
                        <i class="fas fa-info-circle"></i>
                        <small>Note: Files may take a moment to generate after meeting ends. Refresh page if files show as unavailable.</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Toast -->
        <div id="status-toast" class="toast" style="display: none;" role="alert">
            <div class="toast-content">
                <i class="toast-icon"></i>
                <span class="toast-message"></span>
            </div>
            <button class="toast-close" aria-label="Close notification">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay" style="display: none;">
            <div class="loading-spinner">
                <div class="spinner"></div>
                                <p>Processing...</p>
                            </div>
                        </div>

        <!-- Processing Overlay -->
        <div id="processing-overlay" class="processing-overlay" style="display: none;">
            <div class="processing-content">
                <div class="processing-spinner"></div>
                <h3>Processing Meeting Data</h3>
                <p style="color: var(--text-secondary); margin: 0.5rem 0 1.5rem;">Please wait while we process your meeting...</p>
                
                <div class="processing-steps">
                    <div class="processing-step" id="step-diarization">
                        <div class="step-icon">1</div>
                        <div class="step-text">Audio Diarization</div>
                        <div class="step-status">Waiting...</div>
                    </div>
                    <div class="processing-step" id="step-transcript">
                        <div class="step-icon">2</div>
                        <div class="step-text">Transcript Generation</div>
                        <div class="step-status">Waiting...</div>
                    </div>
                    <div class="processing-step" id="step-summary">
                        <div class="step-icon">3</div>
                        <div class="step-text">Summary Creation</div>
                        <div class="step-status">Waiting...</div>
                    </div>
                    <div class="processing-step" id="step-combine">
                        <div class="step-icon">4</div>
                        <div class="step-text">Video Processing</div>
                        <div class="step-status">Waiting...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Removed duplicate bottom video feed element (now uses the element inside the live camera card) -->

    <script src="/static/script.js"></script>
</body>
</html>